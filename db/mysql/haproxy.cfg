global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend mysql_frontend
    bind *:3306
    mode tcp

    # 허용할 IP 주소 목록
    # 아래 예시를 참고하여 실제 허용할 IP/네트워크로 수정하세요
    # 단일 IP 예시: acl allowed_ips src 192.168.1.100
    # 네트워크 대역 예시: acl allowed_ips src 192.168.1.0/24

    # 로컬 네트워크 허용 (예시)
    acl allowed_ips src 127.0.0.1
    acl allowed_ips src 192.168.0.0/16
    acl allowed_ips src 10.0.0.0/8
    acl allowed_ips src 172.16.0.0/12

    # 허용되지 않은 IP는 연결 거부
    tcp-request connection reject if !allowed_ips

    # 허용된 IP는 MySQL 백엔드로 전달
    default_backend mysql_backend

backend mysql_backend
    mode tcp
    balance roundrobin
    option tcp-check

    # MySQL 컨테이너로 연결 (docker-compose의 서비스명 사용)
    server mysql mysql:3306 check
